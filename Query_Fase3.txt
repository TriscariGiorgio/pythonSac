QUERY Fase 3


1- Il numero di film per ogni anno 

def film_per_anno():
	query = """
	SELECT anno, COUNT(*) AS tot_film_anno
	FROM film
	GROUP BY anno
	ORDER BY tot_film_anno DESC;
	"""
	return execute_query(query)

2- Il numero di film per ogni genere

def film_per_genere():
	query = """
	SELECT tipo_genere, COUNT(genere_film.id) AS tot_film_genere
	FROM genere_film
	JOIN generi ON generi.id = genere_film.id_genere	
	GROUP BY tipo_genere
	ORDER BY tot_film_genere DESC;
	"""
	return execute_query(query)

3- I film che hanno recensioni al di sotto di 3 per un numero 250 di persone in modo da eliminarli

def film_con_recensioni_basse():
    query = """
    SELECT f.*
    FROM Film f
    JOIN Rating r ON f.ID = r.film_id
    WHERE r.Valutazione < 3
    GROUP BY f.ID
    HAVING COUNT(DISTINCT r.utente_id) >= 250;
    """
    return execute_query(query)


4-  La top 10 per ogni intervallo di età e sesso
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
def top_10_per_intervallo_eta_sesso():
    query = """
    
    """
    return execute_query(query)

5-  Rating film - i voti dal meno preferito al più preferito per fasce di età
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
def rating_film_per_fascia_eta():
    query = """
    
    """
    return execute_query(query)

6- Il numero degli iscritti alla piattaforma nelle varie province, voglio vedere le prime 20 

def iscritti_per_provincia():
    query = """
    SELECT provincia, COUNT(*) AS numero_iscritti
    FROM Utenti
    GROUP BY provincia
    ORDER BY numero_iscritti DESC
    LIMIT 20;
    """
    return execute_query(query)



7- Il numero degli abbonati in base al lavoro

def abbonati_per_lavoro():
    query = """
    SELECT lavoro, COUNT(*) AS numero_abbonati
    FROM Utenti
    GROUP BY lavoro
    ORDER BY numero_abbonati DESC
    ;
    """
    return execute_query(query)





INSERT INTO film_rating_under_18 (id_film, valutazione_media)
SELECT
  r.film_id,
  AVG(Valutazione) AS voto_medio
FROM rating r
INNER JOIN utenti u ON r.utente_id = u.ID_utente
WHERE u.fascia_eta < "under 18"
GROUP BY r.film_id
ORDER BY valutazione_media;

